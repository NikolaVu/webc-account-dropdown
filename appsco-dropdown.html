<link rel="import" href="bower_components/polymer/polymer.html">

<link rel="import" href="bower_components/neon-animation/neon-animations.html">
<link rel="import" href="bower_components/neon-animation/neon-animation-runner-behavior.html">

<dom-module id="appsco-dropdown">
    <template>
        <style>
            :host{
                display: none;
                background: transparent;
                color: black;
            }
            :host .content {
                @apply(--shadow-elevation-2dp);
                background-color: #ffffff;
                border-radius: 4px;
            }
            :host .caret {
                height: 10px;
                position: relative;
                overflow: hidden;
            }
            :host .caret > div:first-child {
                width: 0;
                height: 0;
                border-left: 11px solid transparent;
                border-right: 11px solid transparent;
                border-bottom: 11px solid rgba(0,0,0, 0.4);
                position: absolute;
                right: 10px;
            }
            :host .caret > div:last-child {
                width: 0;
                height: 0;
                border-left: 10px solid transparent;
                border-right: 10px solid transparent;
                border-bottom: 10px solid var(--caret-color, rgb(255,255,255));
                position: absolute;
                right: 11px;
            }
            :host[open] {
                display: block;
            }
        </style>
        <div class="caret">
            <div></div>
            <div></div>
        </div>
        <div class="content"><content></content></div>
    </template>

    <script>

        Polymer({
            is: 'appsco-dropdown',
            behaviors: [
                Polymer.NeonAnimationRunnerBehavior
            ],
            properties: {
                animationConfig: {
                    type: Object,
                    value: function() {
                        return {
                            'entry': [{
                                name: 'scale-up-animation',
                                node: this,
                                axis: 'y',
                                transformOrigin: '0 0',
                                timing: {
                                    duration: 300
                                }
                            }],
                            'exit': [{
                                name: 'scale-down-animation',
                                node: this,
                                axis: 'y'
                            }]
                        }
                    }
                },
                open: {
                    type: Boolean,
                    value: false,
                    notify: true,
                    reflectToAttribute: true
                }
            },
            listeners: {
                'neon-animation-finish': '_onAnimationFinish',
                'tap': '__handleTap',
                'blur': '__tryHide',
                'open-changed': '__openChanged'
            },
            _onAnimationFinish: function() {
                this.focus();
            },
            __tryHide: function(e) {

                console.log('Blur on dropdown');

//                if (Polymer.dom(e).localTarget != this) {
//                    this.open = false;
//                }

            },
            __openChanged: function(e) {

                if (this.open) {
                    this.playAnimation('entry');
                }
                else {
                    this.playAnimation('exit');
                }

            },
            __handleTap: function(e) {
                e.stopPropagation();

                this.open = true;
                this.focus();
            }
        });
    </script>
</dom-module>
